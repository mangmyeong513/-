<!doctype html>
<html lang="ko" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OVRA – InkCat Fusion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root{
        --paper:#fbfbfb;--ink:#0b0b0b;--line:#e6e6e6;--text:#1c1c1c;--muted:#7a7a7a;--brand:#111;
      }
      html.dark{--paper:#0b0b0d;--ink:#f5f6f8;--line:#24262a;--text:#eceff3;--muted:#96a0aa;--brand:#eaeef2}
      html,body{background:var(--paper);color:var(--text)}
      .card{border:1px solid var(--line);background:color-mix(in oklab,var(--paper) 92%,black 0%);border-radius:1.2rem}
      .chip{padding:.28rem .6rem;border-radius:999px;background:color-mix(in oklab,var(--paper) 98%,black 0%);border:1px solid var(--line);font-size:.72rem;color:var(--muted)}
      .btn{padding:.55rem .9rem;border-radius:.8rem;background:var(--brand);color:var(--paper);border:1px solid color-mix(in oklab,var(--brand) 90%,black 10%)}
      .btn-sub{padding:.45rem .8rem;border-radius:.7rem;background:transparent;border:1px solid var(--line)}
      .press-3d{transform-style:preserve-3d;transition:transform .15s ease, box-shadow .15s ease}
      .press-3d:hover{transform:rotateX(1.5deg) rotateY(-1.5deg) translateZ(2px);box-shadow:0 18px 36px -22px rgba(0,0,0,.35)}
      .tilt{transform:perspective(1200px) rotateX(1deg) rotateY(-1deg)}
      .line-clamp-2{-webkit-line-clamp:2;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}
      .line-clamp-4{-webkit-line-clamp:4;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}
      @keyframes float {0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
      .animate-float{animation:float 9s ease-in-out infinite}
    </style>
  </head>
  <body class="min-h-screen">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      // -------------------- Ink assets --------------------
      const InkCat=({className="",mood=0,alpha=.9})=>{const poses=["M50 70 C40 80 30 95 35 105 C55 120 110 120 130 105 C140 95 130 80 120 70 C130 40 115 30 100 30 C85 30 70 40 75 58 C60 58 55 60 50 70 Z","M55 95 C45 105 45 115 65 120 C80 124 120 124 135 116 C145 110 145 98 130 92 C138 80 130 64 110 64 C95 64 85 68 82 76 C75 72 64 78 60 86 Z","M40 90 C30 100 30 112 48 120 C80 132 130 124 150 110 C160 100 158 88 142 84 C150 70 140 55 118 58 C98 61 90 70 88 78 C80 74 60 76 52 84 Z","M60 78 C48 90 48 106 66 114 C88 124 128 124 146 112 C158 104 154 86 136 84 C142 70 130 56 110 58 C92 60 80 70 78 78 C72 74 64 74 60 78 Z"];return(<svg viewBox="0 0 180 140" className={className} aria-hidden><defs><filter id="blur" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="5"/></filter><radialGradient id="ink" cx="50%" cy="50%" r="60%"><stop offset="0%" stopColor="#171717"/><stop offset="100%" stopColor="#0b0b0b"/></radialGradient></defs><path d="M20 110 C40 120 60 130 80 120 C100 110 95 95 85 92" stroke="#0b0b0b" strokeWidth="18" strokeLinecap="round" filter="url(#blur)" opacity={alpha}/><path d={poses[mood%poses.length]} fill="url(#ink)" filter="url(#blur)" opacity={alpha}/><path d="M85 40 L95 20 L105 40 Z" fill="#0b0b0b" filter="url(#blur)" opacity={alpha}/><path d="M110 42 L122 22 L130 45 Z" fill="#0b0b0b" filter="url(#blur)" opacity={alpha}/><ellipse cx="96" cy="63" rx="6" ry="7" fill="#fff" opacity=".95"/><ellipse cx="118" cy="64" rx="6" ry="7" fill="#fff" opacity=".95"/></svg>)}
      const Smudge=({className=""})=>(<svg viewBox="0 0 200 120" className={className} aria-hidden><defs><filter id="sm" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="9"/></filter></defs><path d="M10,90 C25,20 80,5 110,38 C140,15 175,25 190,70 C140,75 120,95 100,110 C80,100 45,95 10,90 Z" fill="#0f0f0f" filter="url(#sm)" opacity=".08"/></svg>)

      // -------------------- mini modules (single-file) --------------------
      const Store={
        DB:'ovra_fx_posts', NICK:'ovra_fx_nick', FLAGS:'ovra_fx_flags',
        uid:()=>Math.random().toString(36).slice(2)+Date.now().toString(36),
        load:(k,def)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):def}catch(_){return def}},
        save:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
      };
      const Users={
        current:()=>Store.load(Store.NICK, Users.random()),
        set:(n)=>Store.save(Store.NICK,n),
        random:()=>{const a=["서늘","먹빛","잔향","안개","새벽","묵향"], b=["고양이","비둘기","수달","너구리"];return a[Math.floor(Math.random()*a.length)]+b[Math.floor(Math.random()*b.length)]+"#"+Math.floor(100+Math.random()*900)},
        isAdmin:()=>Store.load(Store.FLAGS,{admin:false}).admin,
        setAdmin:(v)=>Store.save(Store.FLAGS,{admin:!!v})
      };
      const Moderation={
        key:'ovra_fx_reports',
        list:()=>Store.load('ovra_fx_reports',[]),
        push:(item)=>{const a=Moderation.list();a.unshift(item);Store.save('ovra_fx_reports',a)},
        remove:(id)=>{Store.save('ovra_fx_reports',Moderation.list().filter(x=>x.id!==id))}
      };

      // tag helper
      const STOP=["그리고","그래서","하지만","그러나","나는","우리는","너는","오늘","지금","정말","약간","너무","진짜","그냥","근데","하면","하려고","해서","하다","했다","하는","했더니","있다","없다","같다","보다"]; 
      const MAP={"우울":"위로","슬퍼":"위로","힘들":"위로","불안":"위로","행복":"기쁨","기뻐":"기쁨","시험":"수능","수능":"수능","공부":"공부","과제":"공부","친구":"친구","연애":"연애","사랑":"연애","게임":"게임","그림":"그림","음악":"음악","노래":"음악","학교":"학교","가족":"가족","운동":"운동","날씨":"날씨","비":"날씨","더워":"날씨","추워":"날씨"};
      const tk=t=>(t||"").toLowerCase().replace(/[\n.,!?~\-()\[\]{}'";:]/g," ").split(/\s+/).filter(Boolean);
      const suggest=(...ts)=>{const words=ts.flatMap(tk);const counts={};for(const w of words){if(w.length<2||STOP.includes(w))continue;const key=MAP[w]||w;counts[key]=(counts[key]||0)+1}const pref=["위로","기쁨","수능","공부","친구","연애","게임","그림","음악","학교","가족","운동","날씨"];const arr=Object.entries(counts).sort((a,b)=>b[1]-a[1]).map(([k])=>k);const out=[];for(const p of pref){if(arr.includes(p))out.push(p)}for(const a of arr){if(!out.includes(a))out.push(a)}return out.slice(0,3)}

      // -------------------- UI atoms --------------------
      const Tag=({children})=> <span className="chip">#{children}</span>;
      const IconBtn=({children,onClick,title})=> <button title={title} onClick={onClick} className="btn-sub hover:shadow-sm press-3d">{children}</button>

      const Header=({nick,onSearch,mode,setMode,toggleDark,isDark})=> (
        <header className="sticky top-0 z-40 bg-[color:var(--paper)]/85 backdrop-blur border-b border-[color:var(--line)]">
          <div className="mx-auto max-w-[1200px] px-4 py-3 flex items-center gap-3">
            <div className="flex items-center gap-2">
              <div className="relative w-9 h-8"><Smudge className="absolute -top-5 -left-3 w-16"/><InkCat className="absolute -top-5 -left-5 w-14" alpha={.5}/></div>
              <h1 className="text-lg font-extrabold tracking-wide">OVRA</h1>
            </div>
            <nav className="ml-4 flex gap-4 text-sm text-[color:var(--muted)]">
              {['feed','lists','explore'].map(m=> (
                <button key={m} className={'pb-1 '+(mode===m?'text-[color:var(--text)] border-b-2 border-[color:var(--text)]':'hover:text-[color:var(--text)]')} onClick={()=>setMode(m)}>{m==='feed'?'피드':m==='lists'?'리스트':'탐색'}</button>
              ))}
            </nav>
            <div className="ml-auto flex items-center gap-2">
              <input onChange={e=>onSearch(e.target.value)} placeholder="검색…" className="rounded-xl px-3 py-2 bg-transparent border border-[color:var(--line)] placeholder-[color:var(--muted)] outline-none"/>
              <IconBtn onClick={toggleDark} title="테마">{isDark?'☀️':'🌙'}</IconBtn>
              <span className="text-xs text-[color:var(--muted)]">{nick}</span>
            </div>
          </div>
        </header>
      );

      // -------------------- Cards --------------------
      const PostCard=({post,me,actions})=>{
        const liked=post.likedBy.includes(me); const bm=post.bookmarkedBy.includes(me);
        return (
          <article className="card press-3d overflow-hidden">
            <div className="relative p-4">
              <Smudge className="absolute -top-10 -right-6 w-40 animate-float pointer-events-none"/>
              <div className="flex items-center gap-2 text-xs text-[color:var(--muted)]">
                <div className="h-8 w-8 rounded-full bg-[color:var(--paper)] border border-[color:var(--line)] flex items-center justify-center">{post.author[0]}</div>
                <button className="hover:underline" onClick={()=>actions.openProfile(post.author)}>{post.author}</button>
                <span>· {new Date(post.ts).toLocaleString()}</span>
                {post.pinned && <span className="ml-2 chip">핀 고정</span>}
              </div>
              <h3 className="mt-2 font-semibold tilt">{post.title||'(제목 없음)'}</h3>
              <p className="mt-1 leading-relaxed line-clamp-4">{post.body}</p>
              {post.image && <img src={post.image} className="mt-3 rounded-xl border border-[color:var(--line)] max-h-96 object-cover w-full"/>}
              {post.quoteOf && (
                <div className="mt-3 p-3 rounded-xl border border-[color:var(--line)] bg-[color:var(--paper)]">
                  <div className="text-[10px] text-[color:var(--muted)] mb-1">옴표</div>
                  <div className="text-sm font-semibold">{post.quoteOf.title}</div>
                  <div className="text-xs text-[color:var(--muted)]">{post.quoteOf.author}</div>
                  <div className="text-sm">{post.quoteOf.body}</div>
                </div>
              )}
              <div className="mt-3 flex flex-wrap gap-2">{post.tags.map(t=> <Tag key={t}>{t}</Tag>)}</div>
            </div>
            <div className="flex items-center justify-between border-t border-[color:var(--line)] px-3 py-2 text-sm text-[color:var(--muted)]">
              <div className="flex gap-4 items-center">
                <button onClick={()=>actions.like(post.id)} className={liked?'font-semibold':''}>{liked?'♥':'♡'} {post.likes}</button>
                <button onClick={()=>actions.openDetail(post.id)}>댓글 {post.comments.length}</button>
                <button onClick={()=>actions.quote(post.id)}>옴표</button>
                <button onClick={()=>actions.bookmark(post.id)} className={bm?'font-semibold':''}>{bm?'🔖해제':'🔖북마크'}</button>
              </div>
              <div className="flex gap-3 items-center">
                <button onClick={()=>actions.report(post.id)}>신고{post.reports?`(${post.reports})`:''}</button>
                {me===post.author && <button onClick={()=>actions.del(post.id)}>삭제</button>}
              </div>
            </div>
          </article>
        )}

      // -------------------- Composer --------------------
      const Composer=({nick,onPost,quote})=>{
        const [title,setTitle]=React.useState('');
        const [body,setBody]=React.useState('');
        const [tags,setTags]=React.useState([]);
        const [tagInput,setTagInput]=React.useState('');
        const [img,setImg]=React.useState(null);
        React.useEffect(()=>{setTags(suggest(title+' '+body))},[title,body]);
        const onFile=async e=>{const f=e.target.files?.[0]; if(!f) return; const bmp=await createImageBitmap(f); const c=document.createElement('canvas'); const s=Math.min(1,1200/bmp.width); c.width=Math.round(bmp.width*s); c.height=Math.round(bmp.height*s); c.getContext('2d').drawImage(bmp,0,0,c.width,c.height); setImg(c.toDataURL('image/jpeg',.82));};
        const submit=()=>{if(!title.trim()&&!body.trim()&&!img) return; onPost({title,body,tags,image:img,quote}); setTitle('');setBody('');setTags([]);setImg(null)}
        return (
          <div className="card p-4 press-3d">
            <div className="flex gap-3">
              <div className="h-10 w-10 shrink-0 rounded-full bg-[color:var(--paper)] border border-[color:var(--line)] flex items-center justify-center">{nick[0]}</div>
              <div className="flex-1">
                <input className="w-full mb-2 rounded-lg px-3 py-2 bg-transparent border border-[color:var(--line)] placeholder-[color:var(--muted)] outline-none" placeholder="제목" value={title} onChange={e=>setTitle(e.target.value.slice(0,80))}/>
                <textarea className="w-full min-h-24 resize-y rounded-lg bg-transparent p-3 outline-none border border-[color:var(--line)] placeholder-[color:var(--muted)]" placeholder="무슨 일이 일어나고 있나요?" value={body} onChange={e=>setBody(e.target.value.slice(0,400))}/>
                {img && <img src={img} className="mt-2 rounded-lg border border-[color:var(--line)] max-h-72 object-cover"/>}
                <div className="mt-2 flex items-center gap-2 flex-wrap">
                  {tags.map(t=> <span key={t} className="chip">#{t}</span>)}
                  <input value={tagInput} onChange={e=>setTagInput(e.target.value)} placeholder="#태그추가" className="rounded-lg px-2 py-1 bg-transparent border border-[color:var(--line)] outline-none"/>
                  <button className="text-xs text-[color:var(--muted)]" onClick={()=>{if(tagInput&&!tags.includes(tagInput))setTags([...tags,tagInput]);setTagInput('')}}>추가</button>
                  <label className="ml-auto text-xs cursor-pointer text-[color:var(--muted)] hover:underline"><input type="file" accept="image/*" className="hidden" onChange={onFile}/>이미지</label>
                </div>
                {quote && (
                  <div className="mt-3 p-3 rounded-xl border border-[color:var(--line)]"><div className="text-[10px] text-[color:var(--muted)] mb-1">옴표 대상</div><div className="font-semibold">{quote.title}</div><div className="text-xs text-[color:var(--muted)]">{quote.author}</div><div>{quote.body}</div></div>
                )}
                <div className="mt-3 flex justify-end gap-2"><button className="btn-sub" onClick={()=>{setTitle('');setBody('');setImg(null)}}>지우기</button><button className="btn" onClick={submit}>게시</button></div>
              </div>
            </div>
          </div>
        )}

      // -------------------- Detail --------------------
      const Detail=({post,onClose,addComment,delComment,me,quote})=>{
        const [txt,setTxt]=React.useState('');
        return (
          <div>
            <div className="flex items-center gap-3 mb-3"><button className="btn-sub" onClick={onClose}>닫기</button><h3 className="font-semibold">상세 보기</h3></div>
            <div className="card p-4">
              <div className="text-xs text-[color:var(--muted)] mb-1">{post.author} · {new Date(post.ts).toLocaleString()}</div>
              <div className="font-semibold">{post.title}</div>
              <p className="mt-1">{post.body}</p>
              {post.image && <img src={post.image} className="mt-2 rounded-lg border border-[color:var(--line)] max-h-96 object-cover w-full"/>}
              <div className="mt-2 flex gap-2 flex-wrap">{post.tags.map(t=> <Tag key={t}>{t}</Tag>)}</div>
              <div className="mt-3 text-sm text-[color:var(--muted)]"><button className="hover:underline" onClick={()=>quote(post.id)}>옴표</button></div>
            </div>
            <div className="mt-4 card p-4">
              <div className="text-sm text-[color:var(--muted)] mb-2">댓글 {post.comments.length}</div>
              <div className="space-y-3 max-h-56 overflow-auto pr-1">
                {post.comments.map(c=> (
                  <div key={c.id} className="p-3 rounded-xl border border-[color:var(--line)]">
                    <div className="flex items-center justify-between"><div className="text-xs text-[color:var(--muted)]">{c.author} · {new Date(c.ts).toLocaleString()}</div><div className="text-xs text-[color:var(--muted)] flex gap-2">{me===c.author && <button className="hover:underline" onClick={()=>delComment(post.id,c.id)}>삭제</button>}<button className="hover:underline" onClick={()=>Moderation.push({id:Store.uid(),type:'comment',pid:post.id,cid:c.id,author:c.author,ts:Date.now(),text:c.text})}>신고</button></div></div>
                    <div className="mt-1">{c.text}</div>
                  </div>
                ))}
                {post.comments.length===0 && <div className="text-[color:var(--muted)] text-sm">아직 댓글이 없어요.</div>}
              </div>
              <div className="mt-3 flex gap-2"><input value={txt} onChange={e=>setTxt(e.target.value.slice(0,160))} placeholder="한 줄 댓글" className="flex-1 rounded-lg px-3 py-2 bg-transparent border border-[color:var(--line)] placeholder-[color:var(--muted)] outline-none"/><button className="btn" onClick={()=>{if(!txt.trim())return;addComment(post.id,txt);setTxt('')}}>등록</button></div>
            </div>
          </div>
        )}

      const Modal=({open,onClose,children})=> open? (
        <div className="fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/10" onClick={onClose}></div>
          <div className="absolute inset-x-0 bottom-0 md:inset-0 md:m-auto md:h-[84vh] max-h-[92vh] overflow-auto mx-2 md:mx-auto md:max-w-2xl card p-4">{children}</div>
        </div>
      ):null;

      // -------------------- App --------------------
      function App(){
        const [nick,setNick]=React.useState(Users.current());
        const [posts,setPosts]=React.useState(Store.load(Store.DB, []));
        const [search,setSearch]=React.useState('');
        const [mode,setMode]=React.useState('feed');
        const [quoteOf,setQuoteOf]=React.useState(null); // object or null
        const [detailId,setDetailId]=React.useState(null);
        const [visible,setVisible]=React.useState(8);
        const [isDark,setDark]=React.useState(document.documentElement.classList.contains('dark'));

        React.useEffect(()=>Users.set(nick),[nick]);
        React.useEffect(()=>Store.save(Store.DB,posts),[posts]);

        // seed
        React.useEffect(()=>{if(posts.length===0){const uid=Store.uid;setPosts([
          {id:uid(),title:'종이에 번지는 공지',body:'잉크는 말수가 적고, 대신 오래 남아.',tags:['공지','업데이트'],author:'시스템',ts:Date.now()-900000,likes:3,likedBy:[],bookmarkedBy:[],image:null,comments:[],reports:0,pinned:true},
          {id:uid(),title:'첫 고양이',body:'빛이 없는 눈동자, 그러나 누구보다 잘 본다.',tags:['메모','고양이'],author:'서늘고양이#101',ts:Date.now()-700000,likes:0,likedBy:[],bookmarkedBy:[],image:null,comments:[],reports:0},
        ])}},[]);

        // infinite scroll
        React.useEffect(()=>{const f=()=>{if((window.innerHeight+window.scrollY)>=document.body.offsetHeight-200){setVisible(v=>Math.min(v+6, filtered().length))}};window.addEventListener('scroll',f);return()=>window.removeEventListener('scroll',f)},[posts,search,mode]);

        const toggleDark=()=>{document.documentElement.classList.toggle('dark');setDark(d=>!d)}

        const onPost=({title,body,tags,image,quote})=>{const p={id:Store.uid(),title,body,tags,author:nick,ts:Date.now(),likes:0,likedBy:[],bookmarkedBy:[],image,comments:[],reports:0}; if(quote){p.quoteOf={id:quote.id,title:quote.title,author:quote.author,body:quote.body}} setPosts([p,...posts]);setQuoteOf(null);window.scrollTo({top:0,behavior:'smooth'})};
        const like=id=>setPosts(ps=>ps.map(p=>p.id===id?{...p,likedBy:p.likedBy.includes(nick)?p.likedBy.filter(u=>u!==nick):[...p.likedBy,nick],likes:p.likedBy.includes(nick)?Math.max(0,p.likes-1):p.likes+1}:p));
        const bookmark=id=>setPosts(ps=>ps.map(p=>p.id===id?{...p,bookmarkedBy:p.bookmarkedBy.includes(nick)?p.bookmarkedBy.filter(u=>u!==nick):[...p.bookmarkedBy,nick]}:p));
        const addComment=(pid,text)=>setPosts(ps=>ps.map(p=>p.id===pid?{...p,comments:[...p.comments,{id:Store.uid(),author:nick,text,ts:Date.now()}]}:p));
        const delComment=(pid,cid)=>setPosts(ps=>ps.map(p=>p.id===pid?{...p,comments:p.comments.filter(c=>c.id!==cid)}:p));
        const del=id=>setPosts(ps=>ps.filter(p=>p.id!==id));
        const report=id=>{setPosts(ps=>ps.map(p=>p.id===id?{...p,reports:(p.reports||0)+1}:p)); const p=posts.find(p=>p.id===id); Moderation.push({id:Store.uid(),type:'post',pid:id,author:p?.author,title:p?.title,ts:Date.now(),text:p?.body})};
        const openProfile=author=>setMode({mode:'profile',who:author===nick?'me':author});
        const openDetail=id=>setDetailId(id);
        const quote=id=>{const p=posts.find(x=>x.id===id); if(p) setQuoteOf({id:p.id,title:p.title,author:p.author,body:p.body})}

        function filtered(){let list=posts.slice(); if(typeof mode==='object'&&mode.mode==='profile'){const who=mode.who==='me'?nick:mode.who; list=list.filter(p=>p.author===who)} else if(mode==='lists'){list=posts.filter(p=>p.bookmarkedBy.includes(nick))} if(search.trim()){const k=search.toLowerCase(); list=list.filter(p=>[p.title,p.body,p.author,...p.tags].join(' ').toLowerCase().includes(k))} return list}
        const list=filtered(); const me=nick; const detail=posts.find(p=>p.id===detailId)||null;

        return (
          <div>
            <Header nick={nick} onSearch={setSearch} mode={mode==='feed'? 'feed': (mode==='lists'?'lists':(typeof mode==='object'?'feed':'explore'))} setMode={m=>setMode(m)} toggleDark={toggleDark} isDark={isDark} />

            {/* sides like X + right widgets like Postype */}
            <div className="mx-auto max-w-[1200px] px-4 py-6 grid grid-cols-12 gap-6">
              {/* left rail */}
              <aside className="hidden lg:block col-span-2 space-y-2 sticky top-20 h-fit">
                <button className="btn w-full">게시하기</button>
                <button className="btn-sub w-full" onClick={()=>setNick(Users.random())}>닉네임 변경</button>
                <div className="card p-3 text-sm text-[color:var(--muted)]">관리자 모드 <input type="checkbox" className="ml-2" checked={Users.isAdmin()} onChange={e=>Users.setAdmin(e.target.checked)}/></div>
                <div className="card p-3"><div className="font-semibold mb-2">빠른 필터</div><div className="flex flex-wrap gap-2">{['공지','업데이트','고양이','메모'].map(t=><span className="chip cursor-pointer" key={t} onClick={()=>setSearch(t)}>{t}</span>)}</div></div>
              </aside>

              {/* center column */}
              <section className="col-span-12 lg:col-span-7 space-y-5">
                <Composer nick={nick} onPost={onPost} quote={quoteOf}/>
                {list.length===0 && <div className="text-center text-[color:var(--muted)]">결과가 없어요.</div>}
                <div className="space-y-5">
                  {list.slice(0,visible).map(p=> (
                    <PostCard key={p.id} post={p} me={me} actions={{like,bookmark,openDetail,quote,openProfile,report,del}}/>
                  ))}
                </div>
                {visible<list.length && <div className="text-center text-[color:var(--muted)]">스크롤하면 더 불러와요…</div>}
              </section>

              {/* right widgets */}
              <aside className="hidden md:block col-span-3 space-y-4">
                <div className="card p-4 relative overflow-hidden">
                  <Smudge className="absolute -top-10 -left-6 w-40"/>
                  <div className="font-semibold">크리에이터용 소식</div>
                  <p className="text-sm text-[color:var(--muted)] mt-1">작은 소식들을 모아 전해요. 업데이트, 팁, 이슈.</p>
                  <ul className="mt-2 text-sm list-disc pl-5 text-[color:var(--muted)]"><li>신고 큐가 관리자 보드에 쌓여요.</li><li>핀 고정(게시글 상단 고정) 지원</li></ul>
                </div>
                <div className="card p-3"><div className="font-semibold mb-2">트렌딩</div><div className="space-y-2 text-sm"><div className="flex items-center gap-2"><span className="chip">#고양이</span> <span className="text-[color:var(--muted)]">3.1K</span></div><div className="flex items-center gap-2"><span className="chip">#메모</span> <span className="text-[color:var(--muted)]">1.2K</span></div></div></div>
                <div className="card p-3"><div className="font-semibold mb-2">북마크</div>{list.filter(p=>p.bookmarkedBy.includes(me)).slice(0,4).map(p=> <div key={p.id} className="text-sm line-clamp-2 border-t border-[color:var(--line)] py-2 first:border-t-0">{p.title}</div>)}</div>
              </aside>
            </div>

            <footer className="mx-auto max-w-[1200px] px-4 py-10 text-center text-xs text-[color:var(--muted)]">© {new Date().getFullYear()} OVRA · fusion ui</footer>

            {/* detail modal */}
            <Modal open={!!detail} onClose={()=>setDetailId(null)}>
              {detail && <Detail post={detail} onClose={()=>setDetailId(null)} addComment={addComment} delComment={delComment} me={me} quote={quote}/>}
            </Modal>

            {/* moderation drawer for admins */}
            {Users.isAdmin() && (
              <div className="fixed bottom-4 right-4">
                <div className="card p-3 w-[320px] press-3d">
                  <div className="flex items-center justify-between"><div className="font-semibold">신고 큐</div><button className="btn-sub" onClick={()=>{localStorage.removeItem('ovra_fx_reports');location.reload()}}>비우기</button></div>
                  <div className="mt-2 max-h-64 overflow-auto space-y-2 text-sm">
                    {Moderation.list().map(r=> (
                      <div key={r.id} className="p-2 border border-[color:var(--line)] rounded-lg">
                        <div className="text-xs text-[color:var(--muted)]">{r.type} · {new Date(r.ts).toLocaleString()}</div>
                        <div className="font-medium line-clamp-2">{r.title||r.text}</div>
                        <div className="mt-2 flex justify-end gap-2 text-xs">
                          <button className="btn-sub" onClick={()=>Moderation.remove(r.id)}>무시</button>
                          <button className="btn-sub" onClick={()=>{
                            if(r.type==='post'){setPosts(ps=>ps.filter(p=>p.id!==r.pid))}
                            else{setPosts(ps=>ps.map(p=>p.id===r.pid?{...p,comments:p.comments.filter(c=>c.id!==r.cid)}:p))}
                            Moderation.remove(r.id)
                          }}>삭제</button>
                        </div>
                      </div>
                    ))}
                    {Moderation.list().length===0 && <div className="text-[color:var(--muted)] text-sm">신고가 없어요.</div>}
                  </div>
                </div>
              </div>
            )}

            {/* floating cats */}
            <div className="pointer-events-none fixed right-2 top-24 w-28 opacity-50"><InkCat mood={1} alpha={.18}/></div>
            <div className="pointer-events-none fixed left-0 bottom-10 w-40 opacity-40"><InkCat mood={3} alpha={.12}/></div>
          </div>
        )
      }

      const root=ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App/>);
    </script>
  </body>
</html>
